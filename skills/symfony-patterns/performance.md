# Performance

## Symfony Cache

```php
use Symfony\Contracts\Cache\CacheInterface;
use Symfony\Contracts\Cache\ItemInterface;

final class ProductService
{
    public function __construct(
        private readonly ProductRepository $repository,
        private readonly CacheInterface $productCache,  // matches pool name in cache.yaml
    ) {}

    public function findActive(): array
    {
        return $this->productCache->get('active_products', function (ItemInterface $item): array {
            $item->expiresAfter(3600);

            return $this->repository->findAllActive();
        });
    }

    public function invalidateCache(): void
    {
        $this->productCache->delete('active_products');
    }
}
```

## HTTP Caching

```php
#[Route('/products', name: 'product_list', methods: ['GET'])]
public function list(): Response
{
    $response = $this->render('product/list.html.twig', [...]);
    $response->setPublic();
    $response->setMaxAge(600);          // 10 minutes browser cache
    $response->setSharedMaxAge(3600);   // 1 hour reverse proxy cache

    return $response;
}
```

## OPcache + Preloading

In `php.ini` (production):

```ini
opcache.enable=1
opcache.memory_consumption=256
opcache.max_accelerated_files=20000
opcache.validate_timestamps=0          ; Disable file-change checks in prod

; Symfony preload script (generated by composer dump-autoload --optimize)
opcache.preload=/var/www/app/var/cache/prod/App_KernelProdContainer.preload.php
opcache.preload_user=www-data
```
